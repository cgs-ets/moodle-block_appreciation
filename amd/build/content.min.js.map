{"version":3,"sources":["../src/content.js"],"names":["define","$","Log","Ajax","Content","rootel","instanceid","self","prototype","main","on","e","preventDefault","button","approve","delete","heart","hasClass","removeClass","toggleClass","addClass","post","closest","id","data","call","methodname","args","done","fail","reason","error","debug","fadeOut","remove","init","first","length","content"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @package   block_appreciation\r\n * @copyright 2020 Michael Vangelovski\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/log', 'core/ajax'], function($, Log, Ajax) {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Initializes the component.\r\n     */\r\n    function init(instanceid) {\r\n        Log.debug('block_appreciation/content: initializing');\r\n\r\n        var rootel = $('[data-region=\"block_appreciation-instance-' + instanceid + '\"]').first();\r\n\r\n        if (!rootel.length) {\r\n            Log.error('block_appreciation/control: wrapping region not found!');\r\n            return;\r\n        }\r\n\r\n        var content = new Content(rootel, instanceid);\r\n        content.main();\r\n    }\r\n\r\n    /**\r\n     * The constructor\r\n     *\r\n     * @constructor\r\n     * @param {jQuery} rootel\r\n     */\r\n    function Content(rootel, instanceid) {\r\n        var self = this;\r\n        self.rootel = rootel;\r\n        self.instanceid = instanceid;\r\n    }\r\n\r\n    /**\r\n     * Run the Audience Selector.\r\n     *\r\n     */\r\n    Content.prototype.main = function () {\r\n        var self = this;\r\n\r\n        // Handle approve click.\r\n        self.rootel.on('click', '.post .action-approve', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.approve(button);\r\n        });\r\n\r\n        // Handle delete click.\r\n        self.rootel.on('click', '.post .action-delete', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.delete(button);\r\n        });\r\n\r\n\r\n        self.rootel.on('click touchstart', '.heart', function() {\r\n            var heart = $(this);\r\n\r\n            if (heart.hasClass('is_animating')) {\r\n                return;\r\n            }\r\n\r\n            if (heart.hasClass('is_selected')) {\r\n                heart.removeClass('is_selected');\r\n            } else {\r\n                heart.toggleClass('is_animating');\r\n            }\r\n        });\r\n\r\n        self.rootel.on('animationend', '.heart', function() {\r\n            var heart = $(this);\r\n            heart.toggleClass('is_animating');\r\n            if (!heart.hasClass('is_selected')) {\r\n                heart.addClass('is_selected');\r\n            }\r\n        });\r\n\r\n    };\r\n\r\n    /**\r\n     * Approve a post.\r\n     *\r\n     * @method approve\r\n     */\r\n    Content.prototype.approve = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var id = post.data('id');\r\n        post.addClass('submitting');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'block_appreciation_approve_post',\r\n            args: { id: id },\r\n            done: function(response) {\r\n                post.removeClass('submitting');\r\n                post.removeClass('unapproved');\r\n            },\r\n            fail: function(reason) {\r\n                post.removeClass('submitting');\r\n                Log.error('block_appreciation/content: failed to approve the post');\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n\r\n    /**\r\n     * Delete a post.\r\n     *\r\n     * @method delete\r\n     */\r\n    Content.prototype.delete = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var id = post.data('id');\r\n        post.addClass('submitting');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'block_appreciation_delete_post',\r\n            args: { id: id },\r\n            done: function(response) {\r\n                post.removeClass('submitting');\r\n                post.addClass('removing');\r\n                post.fadeOut(1000, function() {\r\n                    post.remove();\r\n                });\r\n            },\r\n            fail: function(reason) {\r\n                post.removeClass('submitting');\r\n                Log.error('block_appreciation/content: failed to delete the post');\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"file":"content.min.js"}