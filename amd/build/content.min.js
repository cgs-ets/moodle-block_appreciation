define ("block_appreciation/content",["jquery","core/log","core/ajax","core/templates","core/str","core/modal_factory","core/modal_events","block_appreciation/recipientselector"],function(a,b,c,d,e,f,g,h){'use strict';function i(a,b){var c=this;c.rootel=a;c.instanceid=b;c.component="block_appreciation";c.modals={VIEWUSERS:null};c.templates={VIEWUSERS:"block_appreciation/post_like_users"};c.strings={};e.get_strings([{key:"list:likes",component:c.component}]).then(function(a){c.strings.continueintersection=a[0]})}i.prototype.main=function(){var b=this;b.rootel.on("click",".post .action-approve",function(c){c.preventDefault();var d=a(this);b.approve(d)});b.rootel.on("click",".post .action-delete",function(c){c.preventDefault();var d=a(this);b.delete(d)});b.rootel.on("click touchstart",".heart",function(){var c=a(this);if(c.hasClass("is_animating")){return}if(c.hasClass("is_selected")){c.removeClass("is_selected");b.unlike(c)}else{c.toggleClass("is_animating")}});b.rootel.on("animationend",".heart",function(){var c=a(this);c.toggleClass("is_animating");if(!c.hasClass("is_selected")){c.addClass("is_selected");b.like(c)}});b.rootel.on("click",".post .action-getlikeusers",function(c){c.preventDefault();var d=a(this);b.getLikeUsers(d)});var c=[b.loadModal("VIEWUSERS","Post like users","",f.types.DEFAULT),b.loadTemplate("VIEWUSERS")];a.when.apply(a,c).then(function(){b.rootel.addClass("preloads-completed")});if("undefined"!=typeof InfiniteScroll){new InfiniteScroll(".bapp-list",{path:".next",append:".post",history:!1,status:".page-load-status"})}var d=h.init(b.instanceid);d.rootel.off("click",".recipient-result");d.rootel.on("click",".recipient-result",function(b){b.preventDefault();var c=a(this),e=d.rootel.closest(".user-selector").data("action-base")+c.data("username");window.location.href=e})};i.prototype.approve=function(a){var d=this,e=a.closest(".post"),f=e.data("id");e.addClass("submitting");c.call([{methodname:"block_appreciation_approve_post",args:{id:f},done:function done(){e.removeClass("submitting");e.removeClass("unapproved")},fail:function fail(a){e.removeClass("submitting");b.error("block_appreciation/content: failed to approve the post");b.debug(a)}}])};i.prototype.delete=function(a){var d=this,e=a.closest(".post"),f=e.data("id");e.addClass("submitting");c.call([{methodname:"block_appreciation_delete_post",args:{id:f},done:function done(){e.removeClass("submitting");e.addClass("removing");e.fadeOut(1e3,function(){e.remove()})},fail:function fail(a){e.removeClass("submitting");b.error("block_appreciation/content: failed to delete the post");b.debug(a)}}])};i.prototype.like=function(a){var d=this,e=a.closest(".post"),f=e.data("id");c.call([{methodname:"block_appreciation_like_post",args:{id:f},done:function done(){b.debug("block_appreciation/content: Like successful.")},fail:function fail(a){b.error("block_appreciation/content: Failed to like the post");b.debug(a)}}])};i.prototype.unlike=function(a){var d=this,e=a.closest(".post"),f=e.data("id");c.call([{methodname:"block_appreciation_unlike_post",args:{id:f},done:function done(){b.debug("block_appreciation/content: Unlike successful.")},fail:function fail(a){b.error("block_appreciation/content: Failed to unlike the post");b.debug(a)}}])};i.prototype.getLikeUsers=function(a){var e=this,f=a.closest(".post"),g=f.data("id");if(e.modals.VIEWUSERS){e.modals.VIEWUSERS.getModal().addClass("modal-xl");e.modals.VIEWUSERS.setBody("<div style=\"font-style:italic;\">... Fetching user list ...<div class=\"loader\" style=\"display:block;\"><div class=\"circle spin\"></div></div></div>");e.modals.VIEWUSERS.show();c.call([{methodname:"block_appreciation_get_like_users",args:{id:g},done:function done(a){Object.keys(a.userslist).length;e.modals.VIEWUSERS.setTitle("Likes");d.render(e.templates.VIEWUSERS,a).done(function(a){e.modals.VIEWUSERS.setBody(a)}).fail(function(a){b.debug(a);return"Failed to render post like users."})},fail:function fail(a){b.error("block_appreciation/list: unable to get post like users.");b.debug(a)}}])}};i.prototype.loadModal=function(a,b,c,d){var e=this;return f.create({type:d}).then(function(d){d.setTitle(b);if(c){d.setSaveButtonText(c)}e.modals[a]=d;d.getBackdrop();d.getRoot().addClass("modal-"+a)})};i.prototype.loadTemplate=function(a){var b=this;return d.render(b.templates[a],{})};return{init:function(c){b.debug("block_appreciation/content: initializing");var d=a("[data-region=\"block_appreciation-instance-"+c+"\"]").first();if(!d.length){b.error("block_appreciation/control: wrapping region not found!");return}var e=new i(d,c);e.main()}}});
//# sourceMappingURL=content.min.js.map
