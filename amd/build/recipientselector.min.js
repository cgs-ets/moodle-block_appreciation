define ("block_appreciation/recipientselector",["jquery","core/log","core/ajax","core/templates","core/str"],function(a,b,c,d,e){'use strict';function f(a,b){var c=this;c.rootel=a;c.instanceid=b;c.component="block_appreciation";c.strings={};e.get_strings([{key:"postform:recipientnoselection",component:c.component}]).then(function(a){c.strings.noselectionstr=a[0]})}f.prototype.main=function(){var b=this;b.render();var c;b.rootel.on("keyup",".recipient-autocomplete",function(){clearTimeout(c);var d=a(this);c=setTimeout(function(){b.search(d)},500)});b.rootel.on("click",".recipient-result",function(c){c.preventDefault();var d=a(this);b.add(d)});b.rootel.on("click",".recipient-tag",function(c){c.preventDefault();var d=a(this);b.remove(d)});b.rootel.on("focus",".recipient-autocomplete",function(){b.refocus()});a(document).on("click",function(c){var d=a(c.target);if(d.is(".recipient-autocomplete")||d.is(".recipient-result")){return}b.unfocus()})};f.prototype.add=function(b){var c=this;c.unfocus();var d=a("input[name=\"recipient\"]"),e={username:b.data("username"),photourl:b.find("img").attr("src"),fullname:b.find("span").text()};d.val(JSON.stringify(e));c.render()};f.prototype.remove=function(){var b=this,c=a("input[name=\"recipient\"]");c.val("");b.render()};f.prototype.render=function(){var c=this,e=a("input[name=\"recipient\"]");if(""==e.val()){c.rootel.find(".recipient-selection").html(c.strings.noselectionstr);return}var f=e.val();if(f){var g=JSON.parse(f);console.log(g);d.render("block_appreciation/recipient_selector_tag",g).then(function(a){c.rootel.find(".recipient-selection").html(a)}).fail(function(a){b.error(a)})}};f.prototype.search=function(a){var e=this;e.hasresults=!1;if(""==a.val()){return}c.call([{methodname:"block_appreciation_get_recipient_users",args:{instanceid:e.instanceid,query:a.val()},done:function done(a){if(a.length){e.hasresults=!0;d.render("block_appreciation/recipient_selector_results",{users:a}).then(function(a){var b=e.rootel.find(".recipient-results");b.html(a);b.addClass("active")}).fail(function(a){b.error(a)})}else{e.rootel.find(".recipient-results").removeClass("active")}},fail:function fail(a){b.error("block_appreciation/recipientselector: failed to search.");b.debug(a)}}])};f.prototype.unfocus=function(){var a=this;a.rootel.find(".recipient-results").removeClass("active")};f.prototype.refocus=function(){var a=this;if(a.hasresults){a.rootel.find(".recipient-results").addClass("active")}};return{init:function(c){b.debug("block_appreciation/recipientselector: initializing the recipient-selector component");var d=a(".recipient-selector").first();if(!d.length){b.error("block_appreciation/recipientselector: recipient-selector root element not found!");return}var e=new f(d,c);e.main()}}});
//# sourceMappingURL=recipientselector.min.js.map
